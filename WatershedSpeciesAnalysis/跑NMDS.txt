# Install required packages if not already installed
# install.packages(c("shiny", "ggplot2", "vegan", "ggforce"))

# Load libraries
library(shiny)
library(ggplot2)
library(vegan)
library(ggforce)

# Define UI
ui <- fluidPage(
  titlePanel("NMDS Visualization"),
  sidebarLayout(
    sidebarPanel(
      fileInput("file", "Choose CSV File",
                accept = c("text/csv",
                           "text/comma-separated-values,text/plain",
                           ".csv")),
      helpText("Note: Please upload a CSV file with binary matrix data.")
    ),
    mainPanel(
      plotOutput("nmdsPlot")
    )
  )
)

# Define server
server <- function(input, output) {
  
  # Read data when file is uploaded
  data_LAN <- reactive({
    inFile <- input$file
    if (is.null(inFile)) return(NULL)
    read.csv(inFile$datapath, header = TRUE, row.names = 1)
  })
  
  # Perform NMDS and create plot
  output$nmdsPlot <- renderPlot({
    req(data_LAN())
    
    dfNmds <- metaMDS(data_LAN(), distance = "bray", k = 2, trymax = 100)
    data <- data.frame(dfNmds$points)
    
    ggplot(data, aes(x = MDS1, y = MDS2)) +
      geom_point(size = 2) +
      theme_classic() +
      geom_text(
        aes(label = rownames(data)),
        vjust = 1.5,
        size = 3,
        color = "black"
      ) +
      labs(
        subtitle = paste("stress=", round(dfNmds$stress, 3), sep = "")
      )
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)



